<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoVi – {{ t.change_password.title }}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body class="login-body">

    <div class="login-box">

        <div class="login-logo">
            <span class="logo-lo">Lo</span><span class="logo-vi">Vi</span>
            <div class="logo-sub">PASSWORT ÄNDERN</div>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
            <div class="flash flash-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
        {% endwith %}

        <div class="login-hint">
            Hallo <strong>{{ current_user.username }}</strong> –
            bitte vergib ein neues Passwort (min. 6 Zeichen).
        </div>

        <div class="login-form">
            <div class="form-group">
                <label>{{ t.change_password.new }}</label>
                <input type="password" name="new_password" id="new_password" autofocus>
            </div>
            <div class="form-group">
                <label>{{ t.change_password.repeat }}</label>
                <input type="password" id="new_password2">
            </div>
            <button class="login-btn" type="submit">{{ t.change_password.submit }}</button>
        </div>

        <div class="login-footer">LoVi v0.1 – by Marcel Balda</div>
    </div>

<script>
    function doChange() {
        const p1 = document.getElementById("new_password").value;
        const p2 = document.getElementById("new_password2").value;

        if (p1 !== p2) {
            alert("Passwörter stimmen nicht überein!");
            return;
        }
        if (p1.length < 6) {
            alert("Passwort muss mindestens 6 Zeichen haben!");
            return;
        }

        const form = document.createElement("form");
        form.method = "POST";
        form.action = "/change-password";

        const p = document.createElement("input");
        p.name = "new_password";
        p.value = p1;
        form.appendChild(p);

        document.body.appendChild(form);
        form.submit();
    }

    document.addEventListener("keydown", e => {
        if (e.key === "Enter") doChange();
    });
</script>

</body>
</html>
